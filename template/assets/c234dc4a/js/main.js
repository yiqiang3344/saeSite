// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    SHOW_HEADER && fShowHeader(HEADER);
    if (SYN_HIGHLIGHT) {
      SyntaxHighlighter.all();
    }
    $(".js_cbox_all").click(function(e) {
      var a;
      a = $(this).parents("table").find(".js_cbox,.js_cbox_all");
      if ($(this).filter(":checked").length) {
        $.each(a, function() {
          this.checked = true;
          return true;
        });
      } else {
        $.each(a, function() {
          this.checked = false;
          return true;
        });
      }
      return true;
    });
    return $('.js_logOut').click(function() {
      fOneAjax('Site', 'ajaxLogOut', {}, function(o) {
        if (o.code === 1) {
          return State.back(0);
        }
      }, this);
      return false;
    });
  });

  window.Pager = function(dom, c, a, params, pager, ajax) {
    var a2, b2, className, has_ellipsis, i, last, link, next, p;
    if (pager.page_count <= 1) {
      return '';
    }
    ajax || (ajax = false);
    className = ajax ? 'pager_' + ajax.className : false;
    last = false;
    if (pager.page > 1) {
      params.p = pager.page - 1;
      last = {
        id: ajax ? className + params.p : false,
        href: fGetUrl(c, a, params)
      };
    }
    next = false;
    if (pager.page < pager.page_count) {
      params.p = pager.page + 1;
      next = {
        id: ajax ? className + params.p : false,
        href: fGetUrl(c, a, params)
      };
    }
    p = {
      className: className,
      last: last,
      next: next,
      list: []
    };
    b2 = pager.page - 2;
    a2 = pager.page + 2;
    has_ellipsis = false;
    i = 1;
    while (i <= pager.page_count) {
      if ((i >= b2 && i <= a2) || i === 1 || i === pager.page_count) {
        params.p = i;
        link = {
          ellipsis: false,
          id: ajax ? className + i : false,
          href: fGetUrl(c, a, params),
          name: i,
          select: i === pager.page
        };
      } else {
        link = has_ellipsis ? false : {
          ellipsis: true
        };
        has_ellipsis = true;
      }
      link && p.list.push(link);
      i++;
    }
    dom.html(pagerTemplate.render(p));
    if (ajax) {
      return dom.find('[id^=' + className + ']').click(function() {
        p = this.id.replace(className, '');
        ajax.params.p = p;
        fOneAjax(ajax.c, ajax.a, ajax.params, ajax.callback, this);
        return false;
      });
    }
  };

  window.fGetTime = function() {
    return Math.floor(STIME + (new Date().getTime() - CTIME) / 1000);
  };

  window.fGetUrl = function(c, a, p) {
    var arr, i, k, l, param, pieces, url;
    if (a === undefined) {
      pieces = c.split("/");
      arr = URLCACHE;
      i = 0;
      while (i < pieces.length) {
        if (arr[pieces[i]]) {
          arr = arr[pieces[i]];
        }
        i++;
      }
      return BASEURL + "/" + c + "?v=" + arr;
    } else {
      url = void 0;
      param = void 0;
      if (typeof a === "string") {
        url = BASEURI + "/" + c + "/" + a;
        param = p;
      } else {
        url = BASEURI + "/" + c;
        param = a;
      }
      if (param) {
        l = [];
        for (k in param) {
          l.push(encodeURIComponent(k) + "=" + encodeURIComponent(param[k]));
        }
        l.length > 0 && (url += "?" + l.join("&"));
      }
      return url;
    }
  };

  window.fDateFormat = function(time, flag) {
    var date, ret;
    date = new Date(time * 1000);
    ret = '';
    if (!flag || flag === 1) {
      ret = "" + (date.getFullYear()) + "-" + (date.getMonth() + 1) + "-" + (date.getDate());
    } else if (flag === 2) {
      ret = "" + (date.getFullYear()) + "-" + (date.getMonth() + 1) + "-" + (date.getDate()) + " " + (date.getHours()) + ":" + (date.getMinutes()) + ":" + (date.getSeconds());
    }
    return ret;
  };

  window.fOneAjax = function(c, a, data, succ_callback, dom, hasFile) {
    var fail, k_disable, settings, succ;
    if (hasFile == null) {
      hasFile = false;
    }
    if (dom) {
      k_disable = 0;
      $(dom).each(function() {
        if ($(this).data("k_disable")) {
          k_disable = 1;
        }
        return true;
      });
      if (k_disable) {
        return false;
      } else {
        $(dom).data("k_disable", 1);
      }
    }
    succ = function(obj) {
      dom && $(dom).data("k_disable", 0);
      if (obj === null || typeof obj !== "object" || !obj.code) {
        fail("", "parsererror", "");
      } else if (obj.code === "-1") {
        fail("", "servererror", obj.msg);
      } else {
        succ_callback(obj);
      }
      return true;
    };
    fail = function(jqXHR, textStatus, errorThrown) {
      dom && $(dom).data("k_disable", 0);
      if (jqXHR.status === 0 && textStatus === "error") {
        alert("ajax error: " + errorThrown);
      } else if (textStatus === "parsererror") {
        alert('ajax parsererror');
      } else if (textStatus === "servererror") {
        alert("ajax servererror: " + errorThrown);
      } else {
        alert('ajax error: other');
      }
      return true;
    };
    settings = {
      url: fGetUrl(c, a),
      data: data,
      dataType: "json",
      type: "POST",
      success: succ,
      error: fail
    };
    if (hasFile) {
      settings.processData = settings.contentType = false;
    }
    return $.ajax(settings);
  };

  window.State = {};

  (function() {
    State.forwardToUrl = function(url) {
      return document.location.href = url;
    };
    State.forward = function(c, a, p) {
      return document.location.href = fGetUrl(c, a, p);
    };
    State.replace = function(c, a, p) {
      return document.location.replace(fGetUrl(c, a, p));
    };
    return State.back = function(n) {
      n = n || 0;
      return history.go(-n);
    };
  })();

  window.fShowHeader = function(params) {
    return $('.header').replaceWith(headerTpl.render(params));
  };

  window.oFinalPage = Class.extend({
    init: function(oArgs) {
      this.oArgs = oArgs;
      return this.__fInitData();
    },
    __fInitData: function() {},
    fPrint: function() {
      document.write('<div class="maincontent"></div>');
      return this.fRefresh();
    },
    fRefresh: function(bRefresh) {
      bRefresh = bRefresh != null ? bRefresh : false;
      $('.maincontent').html(this.oArgs.oTemplate.render(this.oArgs.oParams, this.oArgs.oPartials));
      return this.fBind();
    },
    fBind: function() {
      return $('.js_back').click(function() {
        return State.back(1);
      });
    }
  });

  window.fShowErrors = function(errors) {
    return $.each(errors, function(k, v) {
      $('.js_' + k).addClass('merror');
      return console.log(k + ':' + v);
    });
  };

}).call(this);

var headerTpl=new Hogan.Template();headerTpl.r =function(c,p,i){var _=this;_.b(i=i||"");_.b("<div class=\"header\">");_.b("\n" + i);_.b("    <div class=\"mlogo\">后台管理</div>");_.b("\n" + i);_.b("    <div class=\"clearfix\">");_.b("\n" + i);if(_.s(_.f("aNav",c,p,1),c,p,0,99,216,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("        <div class=\"fl ml10\"><a class=\"");if(_.s(_.f("select",c,p,1),c,p,0,150,153,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("udl");});c.pop();}_.b(" ");_.b(_.v(_.f("cls",c,p,0)));_.b("\" href=\"");_.b(_.v(_.f("url",c,p,0)));_.b("\">");_.b(_.v(_.f("name",c,p,0)));_.b("</a></div>");_.b("\n");});c.pop();}_.b("    </div>");_.b("\n" + i);_.b("</div>");return _.fl();;};
var pagerTpl=new Hogan.Template();pagerTpl.r =function(c,p,i){var _=this;_.b(i=i||"");_.b("<div class=\"mpager ");if(_.s(_.f("className",c,p,1),c,p,0,33,46,"{{ }}")){_.rs(c,p,function(c,p,_){_.b(_.v(_.f("className",c,p,0)));});c.pop();}_.b("\">");_.b("\n" + i);if(_.s(_.f("last",c,p,1),c,p,0,76,184,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("    <span class=\"link\"><a href=\"");_.b(_.v(_.d("last.href",c,p,0)));_.b("\" ");if(_.s(_.d("last.id",c,p,1),c,p,0,136,152,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("id=\"");_.b(_.v(_.d("last.id",c,p,0)));_.b("\"");});c.pop();}_.b(">上一页</a></span>");_.b("\n");});c.pop();}if(_.s(_.f("list",c,p,1),c,p,0,207,448,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("    <span class=\"link\">");_.b("\n" + i);if(_.s(_.f("ellipsis",c,p,1),c,p,0,253,274,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("        ...");_.b("\n");});c.pop();}if(!_.s(_.f("ellipsis",c,p,1),c,p,1,0,0,"")){_.b("        <a class=\"");if(_.s(_.f("select",c,p,1),c,p,0,339,342,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("udl");});c.pop();}_.b("\" href=\"");_.b(_.v(_.f("href",c,p,0)));_.b("\" ");if(_.s(_.f("id",c,p,1),c,p,0,378,389,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("id=\"");_.b(_.v(_.f("id",c,p,0)));_.b("\"");});c.pop();}_.b(">");_.b(_.v(_.f("name",c,p,0)));_.b("</a>");_.b("\n");};_.b("    </span>");_.b("\n");});c.pop();}if(_.s(_.f("next",c,p,1),c,p,0,471,579,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("    <span class=\"link\"><a href=\"");_.b(_.v(_.d("next.href",c,p,0)));_.b("\" ");if(_.s(_.d("next.id",c,p,1),c,p,0,531,547,"{{ }}")){_.rs(c,p,function(c,p,_){_.b("id=\"");_.b(_.v(_.d("next.id",c,p,0)));_.b("\"");});c.pop();}_.b(">下一页</a></span>");_.b("\n");});c.pop();}_.b("</div>");return _.fl();;};